# Quick LigerMobile tutorial

The intention with this tutorial is to give an introduction to how one would write LigerMobile applications using javascript. Included in this repo is a template iOS project to get you started quickly. Everything will be either generated by the LigerMobile generator (powered by Yeoman) or typed in.

Having gone through this tutorial you should be able to generate your own applications as well as start to dig into the documentation to go beyond the simple little app created here.

## Prerequisites 

You need to install some software before being able to dig into the tutorial. Make sure everything is installed and works before continuing.

### Node

* Install the latest stable version of node
* Install yeoman ```npm install -g yo```
* Install bower ```npm install -g bower```
* Install gulp ```npm install -g gulp```
* ```git clone https://github.com/reachlocal/generator-ligermobile.git```
* Link the generator with ```npm link``` when in the generator-ligermobile repo

### iOS

* Install the latest non-beta xcode
* ```git clone https://github.com/ligerjohn/ligermobile-template.git```
* Type ```open iOS/Template.xcworkspace``` in the repo to open the workspace to verify that it loads (if you try to run it will get stuck in an NSAssert since we havenâ€™t added a javascript app yet).

 
### Android

TBD

## Generate the app

In the ```common``` folder in ```ligermobile-template``` (that you cloned earlier) create an app in the terminal:

```bash
yo ligermobile
```

When the prompt shows up, select ```tab``` and press enter.

After a while you should have a brand new application. Your ```npm``` packages and ```bower``` packages have been installed and ```gulp``` has been ran to compile templates, move files, etc. The actual app that will be ran can be found in ```app```.

Your folder should now look something like:

```bash
drwxr-xr-x  8 you  wheel   272 Feb 23 13:33 app/
-rw-r--r--  1 you  wheel   215 Feb 23 13:32 bower.json
drwxr-xr-x  6 you  wheel   204 Feb 23 13:32 bower_components/
-rw-r--r--  1 you  wheel  1629 Feb 23 13:32 gulpfile.js
drwxr-xr-x  9 you  staff   306 Feb 23 13:33 node_modules/
-rw-r--r--  1 you  wheel   267 Feb 23 13:32 package.json
drwxr-xr-x  5 you  wheel   170 Feb 23 13:32 pages/
```

* package.json - Includes what we need to run bower, gulp, etc
* bower.json - Is the packages you want in your app
* gulpfile.js - Builds your app
* pages - The source (js, html, jst) for your pages
* app - What will be included in the binary

## cordova.js

The delivery of cordova.js has currently not been solved. Because of this we have to copy a file into the app. This only works for one platform at a time, as the file is different per platform.

Run this in the root of the Template repo:

```bash
cp iOS/Pods/Cordova/CordovaLib/cordova.js common/app/vendor
```

We intend to solve this better in the future.

## Try it out!

Your app should now be able to run. If you press the big "play button" at the top left in Xcode the app should start. If it doesn't consider cleaning the working directory, you can find clean under the product menu in Xcode. Holding down option with the menu open gives you the option for an even deeper clean. This sometimes helps, but luckily Xcode has gotten better with each release and generally you don't need to do anything other than pressing the run button.

If it succeeds you should see the simulator (or your device if you decided to run it on device) running your app with two tabs at the bottom and some text on the screen.

## More pages

Let's add two more pages to the mix. The fastest and easiest way is to generate them:

```bash
yo ligermobile:page contacts page
```
```bash
yo ligermobile:page history page
```

```gulp``` is automatically ran after you generate a page, so everything is compiled and moved over to your ```app``` folder. If you make changes to the files you need to either run ```gulp``` again manually in the root of your application, or run ```gulp watch``` that will automatically look for changes and fix things for you.

We now have two new pages that we can use. They are generated so they don't do much fun, but the skeleton makes it an awful lot easier to not miss any important parts.

## Modify app.json

Having two new pages that you can't see isn't terribly interesting. So let's do something with them. Let's add them to the tab. You can find ```app.json``` in the app folder.

You start out with:

```json
        "pages": [
          {
            "name": "Home",
            "title": "Home",
            "page": "navigator",
            "args": {
              "title": "Home",
              "page": "home",
              "args": {},
              "options": {}
            }
          }, {
            "name": "Settings",
            "title": "Settings",
            "page": "navigator",
            "args": {
              "title": "Settings",
              "page": "settings",
              "args": {},
              "options": {}
            }
          }
        ]
```

And end up with:

```json
        "pages": [
          {
            "name": "Home",
            "title": "Home",
            "page": "navigator",
            "args": {
              "title": "Home",
              "page": "home",
              "args": {},
              "options": {}
            }
          }, {
            "name": "Contacts",
            "title": "Contacts",
            "page": "navigator",
            "args": {
              "title": "Contacts",
              "page": "contacts",
              "args": {},
              "options": {}
            }
          }, {
            "name": "History",
            "title": "History",
            "page": "navigator",
            "args": {
              "title": "History",
              "page": "history",
              "args": {},
              "options": {}
            }
          }, {
            "name": "Settings",
            "title": "Settings",
            "page": "navigator",
            "args": {
              "title": "Settings",
              "page": "settings",
              "args": {},
              "options": {}
            }
          }
        ]
```

Restarting the app (pressing the run play button again) should now get you four tabs instead of two. The ```app.json``` is the root of your app. It describes what page your app should start with as well as some info about colors. If you look at your own file you see that there's a pattern in the json. ```args``` of certain types pages tends to contain other pages. In this case the tabsContainer contains a tab page, which contains a list ("pages" above) of pages. These are the pages you see as "tabs". Try tapping on them and you should see that different pages are displayed.

The tabs will display in the same order as in the array, and if you want to look at how it's done (after finishing this little tutorial) take a look at ```tabs.html```, ```tabs.js```, and ```tabs.jst```. That's right, the tabs are all in html!

## List of contacts

Let's put something on the contacts page, make it a bit more interesting. How about a list of contacts? You will find all these files under the ```pages``` folders under the name of each page.

### contacts.jst

Completely replace the content of the template (jst files are templates, in the same common format used by lodash and others) with a bootstrap list group:

```
<div class="list-group">
  <% _.each(contacts,function(contact){ %>
  <a class="list-group-item"><span><%= contact %></span></a>
  <% }); %>
</div>
```

Again don't forget to run ```gulp``` after you change a page file, such as a template or javascript file. To avoid forgetting, try using ```gulp watch``` that will silently watch for files changing in the background and leap to action when they are.

What we have here is a template. It gets compiled into javascript by ```gulp``` so you can access it from your code. All the compiled javascript is collected in ```template.js```.

### contacts.js

Time to initialize the template with some data. Just an array of strings in this case, but a real life app would more than likely read the data from a server and then add them in via a template. Since we already have the data we don't need to have a temporary UI in place letting our esteemed users that data is forthcoming.

Rewrite the ```initialize``` function as below and add the ```addBindings``` function:

```javascript
  initialize: function() {
    // Initialize your page here (set up your HTML, load json from the net, etc).
    var contacts = ['Tom', 'Dick', 'Harry'];
    $("#contacts_container").html(_.template(window.Templates.contacts({contacts:contacts})));
    CONTACTS.addBindings();
  },

  addBindings:function() {
    $('div.list-group a.list-group-item').on('touchstart', function() {
      $(this).addClass('active').siblings().removeClass('active');
    });

    $('div.list-group a.list-group-item').on('touchend', function() {
      $(this).removeClass('active');
    });
  }
```

```gulp``` again and then running the app we should have a list on the contact page. Don't forget that you need to press the contact tab before you can see the list.

So now we've done two things, first used the template we just created, ```window.Templates.contacts{data_hash:"yes"}```, and inserted that into the DOM and added two bindings to show the selection when we just made and then remove it when the finger goes away.

## Contact details

The list is kind of boring though, doesn't do anything. Let's make it open up a new page!

Create a contactDetail page for us to open:

```
yo ligermobile:page contactDetails page
```

### contacts.js

And add in an extra ```PAGE.openPage(...)``` to open the page:

```javascript
  addBindings:function() {
    $('div.list-group a.list-group-item').on('touchstart', function() {
      $(this).addClass('active').siblings().removeClass('active');
    });

    $('div.list-group a.list-group-item').on('touchend', function() {
      $(this).removeClass('active');
      PAGE.openPage('Detail', 'contactDetails', {}, {});
    });
  }
```

```gulp``` (or not if you are already ```gulp watch```ing) and run the app again. Tap the contacts tab and then tap one of the names in the list of contacts. Now you will see a new page opened up. The way it is opened up is related to the ```navigator``` container page it lives in. Check out the LigerMobile documentation for more on how a ```navigator``` works.

## One more thing

Let's send some data over to the newly opened page!

### contacts.jst

Add in the data-contact-item in the template. This way we save away our data for later.

```
<div class="list-group">
  <% _.each(contacts,function(contact){ %>
  <a class="list-group-item" data-contact-item="<%= escape(JSON.stringify(contact)) %>"><span><%= contact %></span></a>
  <% }); %>
</div>
```

The idea is that when we our binding triggers the function can use ```$(this)``` to extract the data of that very contact. You can easily insert something bigger and more interesting that just a string, as long as it can be turned into json and back to javascript.

### contacts.js

Grab the data out and include it in the args. ```args``` are meant to send data to a page. Options (the next ```{}```) are options for the page. Options are typically handled by the native implementation, to the point where it's not even sent to the javascript. To access your page's args use ```PAGE.args``` after ```initialize``` has been called.

```javascript
  addBindings:function() {
    $('div.list-group a.list-group-item').on('touchstart', function() {
      $(this).addClass('active').siblings().removeClass('active');
    });

    $('div.list-group a.list-group-item').on('touchend', function() {
      $(this).removeClass('active');
      var contactItem = JSON.parse(unescape($(this).data("contact-item")));
      PAGE.openPage('Detail', 'contactDetails', {contact:contactItem}, {});
    });
```

Gulp/Run again and now when you open a contact you see the arguments having been sent to the detail page.

## Done!

This simple demonstration is now over. Feel free to play more with the app and see what it can do. There's more functionality available in PAGE, and there's a number of built in native pages available as well. [Look at the Liger documentation](https://github.com/reachlocal/liger) for more info and don't be shy about pull requests if something is either wrong or missing.
